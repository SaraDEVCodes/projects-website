---
import './src/styles/global.css'
import MainLayout from "../../layouts/MainLayout.astro";
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import ProjectCard from '../../components/ProjectCard.astro';
import SearchForm from '../../components/SearchForm.astro';
import Pagination from '../../components/Pagination.astro';
import { PROJECTS_PER_PAGE } from '../../constants';

const currentPage: number | null = +Astro.url.searchParams.get('page')! || 1;

const allProjects: CollectionEntry<'project'>[] = (await getCollection('project')).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const totalPages: number = Math.ceil(allProjects.length / PROJECTS_PER_PAGE);
---

<MainLayout title = "Projects">
	 <h1 class="text-2xl pb-3">All Projects</h1>

   <SearchForm />

   <br>

      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
       {allProjects.map(project => (

        <ProjectCard project={project} />

       ))}
      </div>

      <Pagination currentPage={currentPage} totalPages={totalPages} />

</MainLayout>